<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Scrapbook</title>
	<script type="text/javascript" src="inc/raphael-min.js"></script>
	<script type="text/javascript" src="lib/Tree.js"></script>
	<script type="text/javascript" src="lib/Node.js"></script>
	<script type="text/javascript" src="src/operating-system.js"></script>
</head>
<body>
<pre id="map"></pre>
<script type="text/javascript">
	var map = document.getElementById("map"),
	    tree = new Tree(),
	    xhr = ajaxRequest(),
	    data = null;

	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			data = JSON.parse(xhr.responseText);
		}
	};
	xhr.open("GET", fileToLoad(), false);
	xhr.setRequestHeader("Content-type", "application/json");
	xhr.overrideMimeType("application/json");
	xhr.send();
	tree.build(data);
	tree.traverse(function(node) {
		var tabbing = "",
		    npattern = "      |",
		    ypattern = "      +";
		if(node.level > 0) {
			if(node.level == 1) {
				tabbing = ypattern;
			}
			else {
				tabbing = npattern;
			}
			for(var i = 1; i < node.level - 1; i++) {
				tabbing += npattern;
			}
			if(node.level > 1) {
				tabbing += ypattern;
			}
			tabbing += "--- ";
		}
		var txt = document.createTextNode(tabbing + node.label + "\n");
		map.appendChild(txt);
	});

	function ajaxRequest() {
		var activexmodes=["Msxml2.XMLHTTP", "Microsoft.XMLHTTP"];
		if(window.ActiveXObject) {
			for(var i=0; i<activexmodes.length; i++) {
				try { return new ActiveXObject(activexmodes[i]) }
				catch(e){ /* suppress error */ }
			}
		}
		else if (window.XMLHttpRequest) {
			return new XMLHttpRequest()
		}
		return null;
	}

	function fileToLoad() {
		var result = null;
		location.search.substr(1).split("&").forEach(function(item) {
			var param = item.split("=");
			if (param[0] === "f") {
				result = decodeURIComponent(param[1]);
			}
		});
		return "src/" + result +".json";
	}
</script>
</body>
</html>
